import{v as S,L as _,r as m,d as D,w,h as B,j as l,c as L,m as T,x as $,o as X,P as z,p as Y,e as C,y as h}from"./index-f76524aa.js";import{L as H}from"./LexicalNestedComposer-744b3b9a.js";const j={...S,paragraph:"StickyEditorTheme__paragraph"},O=j;function p(g,a){const u=g.style,d=a.rootElementRect,y=d!==null?d.left:0,r=d!==null?d.top:0;u.top=r+a.y+"px",u.left=y+a.x+"px"}function K({x:g,y:a,nodeKey:u,color:d,caption:y}){const[r]=_.useLexicalComposerContext(),c=m.useRef(null),f=m.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0});D.useCollaborationContext(),m.useEffect(()=>{const e=f.current;e.x=g,e.y=a;const n=c.current;n!==null&&p(n,e)},[g,a]),w(()=>{const e=f.current,n=new ResizeObserver(s=>{for(let i=0;i<s.length;i++){const b=s[i],{target:P}=b;e.rootElementRect=P.getBoundingClientRect();const k=c.current;k!==null&&p(k,e)}}),t=r.registerRootListener((s,i)=>{i!==null&&n.unobserve(i),s!==null&&n.observe(s)}),o=()=>{const s=r.getRootElement(),i=c.current;s!==null&&i!==null&&(e.rootElementRect=s.getBoundingClientRect(),p(i,e))};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),t()}},[r]),m.useEffect(()=>{const e=c.current;e!==null&&setTimeout(()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")},500)},[]);const x=e=>{const n=c.current,t=f.current,o=t.rootElementRect;n!==null&&t.isDragging&&o!==null&&(t.x=e.pageX-t.offsetX-o.left,t.y=e.pageY-t.offsetY-o.top,p(n,t))},E=e=>{const n=c.current,t=f.current;n!==null&&(t.isDragging=!1,n.classList.remove("dragging"),r.update(()=>{const o=C.$getNodeByKey(u);h(o)&&o.setPosition(t.x,t.y)})),document.removeEventListener("pointermove",x),document.removeEventListener("pointerup",E)},v=()=>{r.update(()=>{const e=C.$getNodeByKey(u);h(e)&&e.remove()})},R=()=>{r.update(()=>{const e=C.$getNodeByKey(u);h(e)&&e.toggleColor()})},{historyState:N}=B();return l("div",{ref:c,className:"sticky-note-container",children:L("div",{className:`sticky-note ${d}`,onPointerDown:e=>{const n=c.current;if(n==null||e.button===2||e.target!==n.firstChild)return;const t=n,o=f.current;if(t!==null){const{top:s,left:i}=t.getBoundingClientRect();o.offsetX=e.clientX-i,o.offsetY=e.clientY-s,o.isDragging=!0,t.classList.add("dragging"),document.addEventListener("pointermove",x),document.addEventListener("pointerup",E),e.preventDefault()}},children:[l("button",{onClick:v,className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),l("button",{onClick:R,className:"color","aria-label":"Change sticky note color",title:"Color",children:l("i",{className:"bucket"})}),L(H.LexicalNestedComposer,{initialEditor:y,initialTheme:O,children:[l(T.HistoryPlugin,{externalHistoryState:N}),l($.PlainTextPlugin,{contentEditable:l(X,{className:"StickyNode__contentEditable"}),placeholder:l(z,{className:"StickyNode__placeholder",children:"What's up?"}),ErrorBoundary:Y})]})]})})}export{K as default};
