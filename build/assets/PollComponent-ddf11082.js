import{L as S,r as C,u as I,e as t,q as P,g as L,j as o,c as g,B as k,d as D,s as O,t as M}from"./index-45ac37f7.js";function b(l){return l.reduce((i,n)=>i+n.votes.length,0)}function E({option:l,index:i,options:n,totalVotes:r,withPollNode:p}){const{clientID:d}=D.useCollaborationContext(),N=C.useRef(null),m=l.votes,x=m.indexOf(d)!==-1,u=m.length,h=l.text;return g("div",{className:"PollNode__optionContainer",children:[o("div",{className:O("PollNode__optionCheckboxWrapper",x&&"PollNode__optionCheckboxChecked"),children:o("input",{ref:N,className:"PollNode__optionCheckbox",type:"checkbox",onChange:_=>{p(s=>{s.toggleVote(l,d)})},checked:x})}),g("div",{className:"PollNode__optionInputWrapper",children:[o("div",{className:"PollNode__optionInputVotes",style:{width:`${u===0?0:u/r*100}%`}}),o("span",{className:"PollNode__optionInputVotesCount",children:u>0&&(u===1?"1 vote":`${u} votes`)}),o("input",{className:"PollNode__optionInput",type:"text",value:h,onChange:_=>{const s=_.target,f=s.value,e=s.selectionStart,c=s.selectionEnd;p(a=>{a.setOptionText(l,f)},()=>{s.selectionStart=e,s.selectionEnd=c})},placeholder:`Option ${i+1}`})]}),o("button",{disabled:n.length<3,className:O("PollNode__optionDelete",n.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{p(_=>{_.deleteOption(l)})}})]})}function $({question:l,options:i,nodeKey:n}){const[r]=S.useLexicalComposerContext(),p=C.useMemo(()=>b(i),[i]),[d,N,m]=I.useLexicalNodeSelection(n),[v,x]=C.useState(null),u=C.useRef(null),h=C.useCallback(e=>{if(d&&t.$isNodeSelection(t.$getSelection())){e.preventDefault();const a=t.$getNodeByKey(n);P(a)&&a.remove(),N(!1)}return!1},[d,n,N]);C.useEffect(()=>L.mergeRegister(r.registerUpdateListener(({editorState:e})=>{x(e.read(()=>t.$getSelection()))}),r.registerCommand(t.CLICK_COMMAND,e=>{const c=e;return c.target===u.current?(c.shiftKey||m(),N(!d),!0):!1},t.COMMAND_PRIORITY_LOW),r.registerCommand(t.KEY_DELETE_COMMAND,h,t.COMMAND_PRIORITY_LOW),r.registerCommand(t.KEY_BACKSPACE_COMMAND,h,t.COMMAND_PRIORITY_LOW)),[m,r,d,n,h,N]);const _=(e,c)=>{r.update(()=>{const a=t.$getNodeByKey(n);P(a)&&e(a)},{onUpdate:c})},s=()=>{_(e=>{e.addOption(M())})},f=t.$isNodeSelection(v)&&d;return o("div",{className:`PollNode__container ${f?"focused":""}`,ref:u,children:g("div",{className:"PollNode__inner",children:[o("h2",{className:"PollNode__heading",children:l}),i.map((e,c)=>{const a=e.uid;return o(E,{withPollNode:_,option:e,index:c,options:i,totalVotes:p},a)}),o("div",{className:"PollNode__footer",children:o(k,{onClick:s,small:!0,children:"Add Option"})})]})})}export{$ as default};
